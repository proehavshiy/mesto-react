(this["webpackJsonpmesto-react"]=this["webpackJsonpmesto-react"]||[]).push([[0],{14:function(e,t,n){},16:function(e,t,n){"use strict";n.r(t);var a=n(1),o=n.n(a),i=n(6),r=n.n(i),c=(n(14),n(9)),s=n(2),p=n(7),u=n(8),l=new(function(){function e(t){var n=t.serverUrl,a=t.cohort,o=t.token;Object(p.a)(this,e),this._serverUrl=n,this._cohort=a,this._token=o}return Object(u.a)(e,[{key:"_checkResponse",value:function(e){return e.ok?e.json():Promise.reject("\u041e\u0448\u0438\u0431\u043a\u0430 ".concat(e.status))}},{key:"getUserInfo",value:function(){return fetch("".concat(this._serverUrl,"/").concat(this._cohort,"/users/me"),{headers:{authorization:this._token}}).then(this._checkResponse)}},{key:"getCards",value:function(){return fetch("".concat(this._serverUrl,"/").concat(this._cohort,"/cards"),{headers:{authorization:this._token}}).then(this._checkResponse)}},{key:"sendUserInfo",value:function(e){var t=e.name,n=e.about;return fetch("".concat(this._serverUrl,"/").concat(this._cohort,"/users/me"),{method:"PATCH",headers:{authorization:this._token,"Content-Type":"application/json"},body:JSON.stringify({name:t,about:n})}).then(this._checkResponse)}},{key:"sendNewCard",value:function(e){var t=e.name,n=e.link;return fetch("".concat(this._serverUrl,"/").concat(this._cohort,"/cards"),{method:"POST",headers:{authorization:this._token,"Content-Type":"application/json"},body:JSON.stringify({name:t,link:n})}).then(this._checkResponse)}},{key:"deleteCard",value:function(e){return fetch("".concat(this._serverUrl,"/").concat(this._cohort,"/cards/").concat(e),{method:"DELETE",headers:{authorization:this._token,"Content-Type":"application/json"},body:JSON.stringify({_id:e})}).then(this._checkResponse)}},{key:"sendUserAvatar",value:function(e){var t=e.avatar;return fetch("".concat(this._serverUrl,"/").concat(this._cohort,"/users/me/avatar"),{method:"PATCH",headers:{authorization:this._token,"Content-Type":"application/json"},body:JSON.stringify({avatar:t})}).then(this._checkResponse)}},{key:"changeLikeCardStatus",value:function(e,t){return fetch("".concat(this._serverUrl,"/").concat(this._cohort,"/cards/likes/").concat(e),{method:t?"PUT":"DELETE",headers:{authorization:this._token,"Content-Type":"application/json"},body:JSON.stringify({cardID:e,like:t})}).then(this._checkResponse)}}]),e}())({serverUrl:"https://mesto.nomoreparties.co/v1",cohort:"cohort-22",token:"a039ff03-9c34-4fce-91e0-77cd409474e3"}),_=o.a.createContext(),d=n.p+"static/media/Mesto-logo.5f3664ca.svg",m=n(0);var f=function(){return Object(m.jsx)("header",{className:"header page__section page__header",children:Object(m.jsx)("img",{className:"logo",src:d,alt:"\u043b\u043e\u0433\u043e\u0442\u0438\u043f \u041c\u0435\u0441\u0442\u043e"})})};var j=function(e){var t=e.card,n=e.onCardClick,a=e.onCardLike,i=e.onCardDelete,r=o.a.useContext(_),c=t.owner._id===r._id,s=t.likes.some((function(e){return e._id===r._id}));return Object(m.jsxs)("figure",{className:"element",children:[Object(m.jsx)("img",{className:"element__image",src:t.link,alt:t.name,onClick:function(){n(t)}}),c&&Object(m.jsx)("button",{className:"element__button-delete page__button",type:"button","aria-label":"\u0423\u0434\u0430\u043b\u0438\u0442\u044c \u043a\u0430\u0440\u0442\u043e\u0447\u043a\u0443",onClick:function(){i(t)}}),Object(m.jsxs)("figcaption",{className:"element__figcaption",children:[Object(m.jsx)("h2",{className:"element__card-title",children:t.name}),Object(m.jsxs)("div",{className:"element__like-section",children:[Object(m.jsx)("button",{className:"element__button-like page__button ".concat(s?"button-like_active":""),type:"button",onClick:function(){a(t)}}),Object(m.jsx)("p",{className:"element__like-counter",children:t.likes.length})]})]})]},t._id)};var h=function(e){var t=e.cards,n=e.onEditProfile,a=e.onAddPlace,i=e.onEditAvatar,r=e.onCardClick,c=e.onCardLike,s=e.onCardDelete,p=o.a.useContext(_),u=p.name,l=p.about,d=p.avatar;return Object(m.jsxs)("main",{className:"content",children:[Object(m.jsxs)("section",{className:"profile page__section page__profile",children:[Object(m.jsx)("div",{className:"profile__avatar avatar-form-open-button",style:{backgroundImage:"url(".concat(d,")")},onClick:i}),Object(m.jsxs)("div",{className:"profile__info",children:[Object(m.jsx)("h1",{className:"profile__title",children:u}),Object(m.jsx)("button",{className:"profile__change-button page__button profile-form-open-button",onClick:n,type:"button","aria-label":"\u041a\u043d\u043e\u043f\u043a\u0430 \u0420\u0435\u0434\u0430\u043a\u0442\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u043f\u0440\u043e\u0444\u0438\u043b\u044c"}),Object(m.jsx)("p",{className:"profile__subtitle",children:l})]}),Object(m.jsx)("button",{className:"profile__add-button page__button add-card-form-open-button",onClick:a,type:"button","aria-label":"\u041a\u043d\u043e\u043f\u043a\u0430 \u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u043a\u0430\u0440\u0442\u043e\u0447\u043a\u0443"})]}),Object(m.jsx)("section",{className:"elements page__section",children:t.map((function(e){return Object(m.jsx)(j,{card:e,onCardClick:r,onCardLike:c,onCardDelete:s},e._id)}))})]})};var b=function(){return Object(m.jsx)("footer",{className:"footer page__section",children:Object(m.jsxs)("p",{className:"footer__copyright",children:["\xa9 ",(new Date).getFullYear()," Mesto Russia"]})})};var v=function(e){var t=e.card,n=e.onClose,a=t?"popup__flexed popup_opened":"popup__flexed";return o.a.useEffect((function(){if(t){var e=function(e){"Escape"===e.key&&n()};return document.addEventListener("keyup",e),function(){document.removeEventListener("keyup",e)}}}),[t,n]),Object(m.jsx)("div",{className:"popup popup_open-image ".concat(a),onClick:function(e){e.target===e.currentTarget&&n()},children:Object(m.jsxs)("div",{className:"popup__container popup__container_open-image",children:[t?Object(m.jsx)("button",{className:"popup__button-close popup__button-close_open-image page__button",onClick:function(e){e.target===e.currentTarget&&n()},type:"button","aria-label":"\u0437\u0430\u043a\u0440\u044b\u0442\u044c \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0435"}):"",Object(m.jsxs)("figure",{className:"popup__figure",children:[Object(m.jsx)("img",{className:"popup__image",src:t?t.link:"",alt:t?"\u043a\u0430\u0440\u0442\u0438\u043d\u043a\u0430: ".concat(t.name):""}),Object(m.jsx)("figcaption",{className:"popup__figcaption",children:t?t.name:""})]})]})})};var g=function(e){var t=e.name,n=e.title,a=e.submitText,i=e.isOpen,r=e.onClose,c=e.onSubmit,s=e.submitButtonState,p=e.children,u=i?"popup__flexed popup_opened":"popup__flexed";return o.a.useEffect((function(){if(i){var e=function(e){"Escape"===e.key&&r()};return document.addEventListener("keyup",e),function(){document.removeEventListener("keyup",e)}}}),[i,r]),Object(m.jsx)("div",{className:"popup popup_".concat(t," ").concat(u),onClick:function(e){e.target===e.currentTarget&&r()},children:Object(m.jsxs)("div",{className:"popup__container popup__container_form popup__container_".concat(t),children:[Object(m.jsx)("button",{className:"popup__button-close popup__button-close_".concat(t," page__button"),onClick:function(e){e.target===e.currentTarget&&r()},"aria-label":"\u041a\u043d\u043e\u043f\u043a\u0430 \u0417\u0430\u043a\u0440\u044b\u0442\u044c \u0444\u043e\u0440\u043c\u0443",type:"button"}),Object(m.jsxs)("form",{className:"popup__form",onSubmit:c,name:"".concat(t,"-form"),noValidate:!0,autoComplete:"off",children:[Object(m.jsx)("h2",{className:"popup__heading",children:n}),p,Object(m.jsx)("button",{className:"popup__button-save popup__button-save_".concat(t," page__button ").concat(!s&&"popup__button-save_disabled"),disabled:!s,type:"submit",value:"\u041e\u0442\u043f\u0440\u0430\u0432\u0438\u0442\u044c \u043d\u0430 \u0441\u0435\u0440\u0432\u0435\u0440","aria-label":"\u041a\u043d\u043e\u043f\u043a\u0430 \u0421\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c \u0444\u043e\u0440\u043c\u0443",children:a})]})]})})};var O=function(e){var t=e.isOpen,n=e.onClose,a=e.onUpdateUser,i=e.isSubmitting,r=o.a.useContext(_),c=o.a.useState({}),p=Object(s.a)(c,2),u=p[0],l=p[1],d=o.a.useState({}),f=Object(s.a)(d,2),j=f[0],h=f[1],b=!!(u.value&&j.value&&u.valid&&j.valid),v=i?"\u0421\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c":"\u0421\u043e\u0445\u0440\u0430\u043d\u0435\u043d\u0438\u0435...",O=u.errorMessage?"popup__input_error":"",x=u.errorMessage?"popup__input-error_active":"",k=j.errorMessage?"popup__input_error":"",N=j.errorMessage?"popup__input-error_active":"";function C(e){var t=e.target,n=t.name,a=t.value,o=t.validity.valid,i=t.validationMessage;"profile-name"===n&&l({value:a,valid:o,errorMessage:i}),"profile-signing"===n&&h({value:a,valid:o,errorMessage:i})}return o.a.useEffect((function(){l({value:r.name,valid:!0,errorMessage:""}),h({value:r.about,valid:!0,errorMessage:""})}),[r]),Object(m.jsx)(g,{name:"change-profile",title:"\u0420\u0435\u0434\u0430\u043a\u0442\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u043f\u0440\u043e\u0444\u0438\u043b\u044c",submitText:v,isOpen:t,onClose:n,onSubmit:function(e){e.preventDefault(),a({name:u.value,about:j.value})},submitButtonState:b,children:Object(m.jsxs)("fieldset",{className:"popup__profile-information",children:[Object(m.jsxs)("section",{className:"popup__input-section",children:[Object(m.jsx)("input",{className:"popup__input popup__input_profile-name ".concat(O),value:u.value||"",onChange:C,type:"text",name:"profile-name",placeholder:"\u0418\u043c\u044f",required:!0,minLength:2,maxLength:40}),Object(m.jsx)("span",{className:"popup__input-error popup__input-error_type_profile-name ".concat(x),children:u.errorMessage})]}),Object(m.jsxs)("section",{className:"popup__input-section",children:[Object(m.jsx)("input",{className:"popup__input popup__input_profile-signing ".concat(k),value:j.value||"",onChange:C,type:"text",name:"profile-signing",placeholder:"\u041f\u043e\u0434\u043f\u0438\u0441\u044c",required:!0,minLength:2,maxLength:200}),Object(m.jsx)("span",{className:"popup__input-error popup__input-error_type_profile-signing ".concat(N),children:j.errorMessage})]})]})})};var x=function(e){var t=e.isOpen,n=e.onClose,a=e.onUpdateAvatar,i=e.isSubmitting,r=o.a.useState({}),c=Object(s.a)(r,2),p=c[0],u=c[1],l=!!(p.value&&p.value&&p.valid&&p.valid),_=i?"\u0421\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c":"\u0421\u043e\u0445\u0440\u0430\u043d\u0435\u043d\u0438\u0435...",d=p.errorMessage?"popup__input_error":"",f=p.errorMessage?"popup__input-error_active":"";return o.a.useEffect((function(){!0===i&&u({value:"",valid:!0,errorMessage:""})}),[i]),Object(m.jsx)(g,{name:"avatar",title:"\u041e\u0431\u043d\u043e\u0432\u0438\u0442\u044c \u0430\u0432\u0430\u0442\u0430\u0440",submitText:_,isOpen:t,onClose:n,onSubmit:function(e){e.preventDefault(),a({avatar:p.value})},submitButtonState:l,children:Object(m.jsx)("fieldset",{className:"popup__profile-information",children:Object(m.jsxs)("section",{className:"popup__input-section",children:[Object(m.jsx)("input",{className:"popup__input popup__input_image-link ".concat(d),value:p.value||"",onChange:function(e){var t=e.target,n=t.value,a=t.validity.valid,o=t.validationMessage;u({value:n,valid:a,errorMessage:o})},type:"url",name:"image-link",placeholder:"\u0421\u0441\u044b\u043b\u043a\u0430 \u043d\u0430 \u043a\u0430\u0440\u0442\u0438\u043d\u043a\u0443",required:!0}),Object(m.jsx)("span",{className:"popup__input-error popup__input-error_type_image-link ".concat(f),children:p.errorMessage})]})})})};var k=function(e){var t=e.isOpen,n=e.onClose,a=e.onAddPlace,i=e.isSubmitting,r=o.a.useState({}),c=Object(s.a)(r,2),p=c[0],u=c[1],l=o.a.useState({}),_=Object(s.a)(l,2),d=_[0],f=_[1],j=!!(p.value&&d.value&&p.valid&&d.valid),h=i?"\u0421\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c":"\u0414\u043e\u0431\u0430\u0432\u043b\u0435\u043d\u0438\u0435...",b=p.errorMessage?"popup__input_error":"",v=p.errorMessage?"popup__input-error_active":"",O=d.errorMessage?"popup__input_error":"",x=d.errorMessage?"popup__input-error_active":"";function k(e){var t=e.target,n=t.name,a=t.value,o=t.validity.valid,i=t.validationMessage;"location-name"===n&&u({value:a,valid:o,errorMessage:i}),"image-link"===n&&f({value:a,valid:o,errorMessage:i})}return o.a.useEffect((function(){!0===i&&(u({}),f({}))}),[i]),Object(m.jsx)(g,{name:"add-card",title:"\u041d\u043e\u0432\u043e\u0435 \u043c\u0435\u0441\u0442\u043e",submitText:h,isOpen:t,onClose:n,onSubmit:function(e){e.preventDefault(),a({name:p.value,link:d.value})},submitButtonState:j,children:Object(m.jsxs)("fieldset",{className:"popup__profile-information",children:[Object(m.jsxs)("section",{className:"popup__input-section",children:[Object(m.jsx)("input",{className:"popup__input popup__input_location-name ".concat(b),value:p.value||"",onChange:k,type:"text",name:"location-name",placeholder:"\u041d\u0430\u0437\u0432\u0430\u043d\u0438\u0435",required:!0,minLength:2,maxLength:30}),Object(m.jsx)("span",{className:"popup__input-error popup__input-error_type_location-name ".concat(v),children:p.errorMessage})]}),Object(m.jsxs)("section",{className:"popup__input-section",children:[Object(m.jsx)("input",{className:"popup__input popup__input_image-link ".concat(O),value:d.value||"",onChange:k,type:"url",name:"image-link",placeholder:"\u0421\u0441\u044b\u043b\u043a\u0430 \u043d\u0430 \u043a\u0430\u0440\u0442\u0438\u043d\u043a\u0443",required:!0}),Object(m.jsx)("span",{className:"popup__input-error popup__input-error_type_image-link ".concat(x),children:d.errorMessage})]})]})})};var N=function(){return Object(m.jsx)(g,{name:"confirm-deletion",title:"\u0412\u044b \u0443\u0432\u0435\u0440\u0435\u043d\u044b?",submitText:"\u0414\u0430"})};var C=function(){return Object(m.jsxs)("div",{className:"spinner page__section",children:[Object(m.jsx)("div",{className:"spinner__part spinner__part_one"}),Object(m.jsx)("div",{className:"spinner__part spinner__part_two"}),Object(m.jsx)("div",{className:"spinner__part spinner__part_three"}),Object(m.jsx)("div",{className:"spinner__part spinner__part_four"}),Object(m.jsx)("div",{className:"spinner__part spinner__part_five"}),Object(m.jsx)("div",{className:"spinner__part spinner__part_six"}),Object(m.jsx)("div",{className:"spinner__part spinner__part_seven"}),Object(m.jsx)("div",{className:"spinner__part spinner__part_eight"})]})};var y=function(){var e=o.a.useState(!1),t=Object(s.a)(e,2),n=t[0],a=t[1],i=o.a.useState(!1),r=Object(s.a)(i,2),p=r[0],u=r[1],d=o.a.useState(!1),j=Object(s.a)(d,2),g=j[0],y=j[1],S=o.a.useState(null),M=Object(s.a)(S,2),E=M[0],U=M[1];function T(){y(!1),a(!1),u(!1),U(null)}var L=o.a.useState(null),P=Object(s.a)(L,2),A=P[0],D=P[1],R=o.a.useState(!1),w=Object(s.a)(R,2),I=w[0],z=w[1],J=o.a.useState([]),B=Object(s.a)(J,2),F=B[0],q=B[1],H=o.a.useState({profile:!0,avatar:!0,place:!0}),V=Object(s.a)(H,2),Y=V[0],G=V[1];return o.a.useEffect((function(){Promise.all([l.getUserInfo(),l.getCards()]).then((function(e){var t=Object(s.a)(e,2),n=t[0],a=t[1];D(n),q(a),z(!0)})).catch((function(e){console.log("\u041e\u0448\u0438\u0431\u043a\u0430 \u043f\u043e\u043b\u0443\u0447\u0435\u043d\u0438\u044f \u0434\u0430\u043d\u043d\u044b\u0445:",e)}))}),[]),Object(m.jsx)(_.Provider,{value:A,children:Object(m.jsxs)("div",{className:"page",children:[Object(m.jsx)(f,{}),I?Object(m.jsxs)(m.Fragment,{children:[Object(m.jsx)(h,{cards:F,onEditProfile:function(){y(!0)},onAddPlace:function(){u(!0)},onEditAvatar:function(){a(!0)},onCardClick:function(e){U(e)},onCardLike:function(e){var t=e.likes.some((function(e){return e._id===A._id}));l.changeLikeCardStatus(e._id,!t).then((function(t){q((function(n){return n.map((function(n){return n._id===e._id?t:n}))}))})).catch((function(e){console.log("\u043e\u0448\u0438\u0431\u043a\u0430 \u043b\u0430\u0439\u043a\u0430",e)}))},onCardDelete:function(e){l.deleteCard(e._id).then((function(){q(F.filter((function(t){return t._id!==e._id})))})).catch((function(e){console.log("\u043e\u0448\u0438\u0431\u043a\u0430 \u043f\u043e\u043b\u0443\u0447\u0435\u043d\u0438\u044f \u0434\u0430\u043d\u043d\u044b\u0445",e)}))}}),Object(m.jsx)(b,{}),Object(m.jsx)(O,{isOpen:g,onClose:T,onUpdateUser:function(e){G({profile:!1,avatar:!0,place:!0}),l.sendUserInfo(e).then((function(e){D(e),T()})).catch((function(e){console.log("\u041e\u0448\u0438\u0431\u043a\u0430 \u043f\u043e\u043b\u0443\u0447\u0435\u043d\u0438\u044f \u0434\u0430\u043d\u043d\u044b\u0445:",e)})).finally((function(){G({profile:!0,avatar:!0,place:!0})}))},isSubmitting:Y.profile}),Object(m.jsx)(x,{isOpen:n,onClose:T,onUpdateAvatar:function(e){G({profile:!0,avatar:!1,place:!0}),l.sendUserAvatar(e).then((function(e){D(e),T()})).catch((function(e){console.log("\u041e\u0448\u0438\u0431\u043a\u0430 \u043f\u043e\u043b\u0443\u0447\u0435\u043d\u0438\u044f \u0434\u0430\u043d\u043d\u044b\u0445:",e)})).finally((function(){G({profile:!0,avatar:!0,place:!0})}))},isSubmitting:Y.avatar}),Object(m.jsx)(k,{isOpen:p,onClose:T,onAddPlace:function(e){G({profile:!0,avatar:!0,place:!1}),l.sendNewCard(e).then((function(e){q([e].concat(Object(c.a)(F))),T()})).catch((function(e){console.log("\u041e\u0448\u0438\u0431\u043a\u0430 \u043f\u043e\u043b\u0443\u0447\u0435\u043d\u0438\u044f \u0434\u0430\u043d\u043d\u044b\u0445:",e)})).finally((function(){G({profile:!0,avatar:!0,place:!0})}))},isSubmitting:Y.place}),Object(m.jsx)(v,{card:E,onClose:T}),Object(m.jsx)(N,{})]}):Object(m.jsx)(C,{})]})})},S=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,17)).then((function(t){var n=t.getCLS,a=t.getFID,o=t.getFCP,i=t.getLCP,r=t.getTTFB;n(e),a(e),o(e),i(e),r(e)}))};r.a.render(Object(m.jsx)(o.a.StrictMode,{children:Object(m.jsx)(y,{})}),document.getElementById("root")),S()}},[[16,1,2]]]);
//# sourceMappingURL=main.1c9a09f9.chunk.js.map